<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Tilicoins</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background-color: #2e1c80;
            color: white;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            border-radius: 10px;
        }

        .coin-creator {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .canvas-container {
            margin: 2rem 0;
            text-align: center;
            position: relative;
        }

        canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            max-width: 100%;
            background-color: white;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .button {
            background-color: #4c1d95;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .button:hover {
            background-color: #6d28d9;
        }

        .download-button {
            background-color: #047857 !important;
        }

        .serial-number {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            letter-spacing: 2px;
            pointer-events: none;
        }

        .qr-code {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Creador de Tilicoins</h1>
        <p>Diseña y descarga tu Tilicoin personalizado</p>
    </header>

    <div class="coin-creator">
        <div class="form-group">
            <label for="nombreComercio">Nombre del Comercio:</label>
            <input type="text" id="nombreComercio" placeholder="Nombre de tu negocio" required>
        </div>

        <div class="form-group">
            <label for="coinColor">Color del Tilicoin:</label>
            <input type="color" id="coinColor" value="#4c1d95">
        </div>

        <div class="form-group">
            <label for="coinPattern">Patrón de Seguridad:</label>
            <select id="coinPattern">
                <option value="premium">Premium</option>
                <option value="standard">Estándar</option>
                <option value="basic">Básico</option>
            </select>
        </div>

        <div class="canvas-container">
            <canvas id="coinCanvas" width="400" height="400"></canvas>
        </div>

        <div class="button-group">
            <button class="button" onclick="generarTilicoin()">Generar Tilicoin</button>
            <button class="button download-button" onclick="descargarTilicoin()">Descargar Imagen</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('coinCanvas');
        const ctx = canvas.getContext('2d');
        let serialNumber = '';
        let qrCode = null;

        function generarTilicoin() {
            const nombre = document.getElementById('nombreComercio').value;
            const color = document.getElementById('coinColor').value;
            const pattern = document.getElementById('coinPattern').value;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Diseño base
            ctx.beginPath();
            ctx.arc(canvas.width/2, canvas.height/2, 180, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 5;
            ctx.stroke();

            // Patrón de seguridad
            dibujarPatronSeguridad(pattern);

            // Texto principal
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(nombre || 'Mi Tilicoin', canvas.width/2, canvas.height/2 - 20);
            
            // Detalles de valor
            ctx.font = '24px Arial';
            ctx.fillText('Valor: $9.000', canvas.width/2, canvas.height/2 + 20);
            ctx.fillText('Canje: $10.000', canvas.width/2, canvas.height/2 + 60);

            // Generar seguridad
            serialNumber = generarNumeroSerie();
            ctx.font = '12px Arial';
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.fillText(serialNumber, canvas.width/2, canvas.height - 30);

            // Generar QR
            generarQRCode();
        }

        function generarNumeroSerie() {
            const timestamp = Date.now().toString(36).toUpperCase();
            const random = Math.random().toString(36).substr(2, 6).toUpperCase();
            return `TLC-${timestamp}-${random}`;
        }

        function generarQRCode() {
            if(qrCode) qrCode.clear();
            
            const qrData = JSON.stringify({
                serial: serialNumber,
                comercio: document.getElementById('nombreComercio').value,
                valor: 9000,
                canje: 10000,
                fecha: new Date().toISOString()
            });

            qrCode = new QRCode(document.createElement('div'), {
                text: qrData,
                width: 80,
                height: 80,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            // Dibujar QR en canvas
            setTimeout(() => {
                const qrCanvas = qrCode._el.firstChild;
                ctx.drawImage(qrCanvas, 
                    canvas.width/2 - 40, 
                    canvas.height - 100, 
                    80, 80);
            }, 100);
        }

        function dibujarPatronSeguridad(pattern) {
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 1;

            switch(pattern) {
                case 'premium':
                    for(let i = 0; i < 360; i += 5) dibujarLineaSeguridad(i);
                    dibujarCirculosConcentricos(8);
                    break;
                case 'standard':
                    for(let i = 0; i < 360; i += 15) dibujarLineaSeguridad(i);
                    dibujarCirculosConcentricos(4);
                    break;
                case 'basic':
                    for(let i = 0; i < 360; i += 30) dibujarLineaSeguridad(i);
                    dibujarCirculosConcentricos(2);
                    break;
            }
        }

        function dibujarLineaSeguridad(grados) {
            const radianes = grados * Math.PI / 180;
            const x = canvas.width/2 + Math.cos(radianes) * 150;
            const y = canvas.height/2 + Math.sin(radianes) * 150;
            ctx.beginPath();
            ctx.moveTo(canvas.width/2, canvas.height/2);
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function dibujarCirculosConcentricos(cantidad) {
            for(let i = 1; i <= cantidad; i++) {
                ctx.beginPath();
                ctx.arc(canvas.width/2, canvas.height/2, 180 - (i * 20), 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        function descargarTilicoin() {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = 800;
            tempCanvas.height = 800;
            
            tempCtx.drawImage(canvas, 0, 0, 800, 800);
            
            const nombre = document.getElementById('nombreComercio').value.replace(/\s+/g, '-') || 'tilicoin';
            const enlace = document.createElement('a');
            enlace.download = `${nombre}-${serialNumber}.png`;
            enlace.href = tempCanvas.toDataURL('image/png');
            enlace.click();
        }

        window.onload = generarTilicoin;
    </script>
</body>
</html>